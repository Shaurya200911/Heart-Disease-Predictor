<!-- /mnt/data/index.html -->
<!doctype html>
<html lang="en">

<head>
    <!-- Required meta -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Heart Disease Detector</title>

    <!-- Bootstrap 5 CSS (CDN) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        /* full-viewport hero */
        .hero {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #0d6efd22 0%, #6f42c122 50%), url('/static/heart-bg.jpg');
            background-size: cover;
            background-position: center;
        }

        .hero-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(4px);
            border-radius: 12px;
            padding: 2rem;
            max-width: 900px;
            width: 100%;
        }

        .scroll-btn {
            scroll-behavior: smooth;
        }

        footer.small-disclaimer {
            background: #f8f9fa;
            padding: 1rem 0;
        }

        .field-help {
            font-size: .85rem;
            color: #6c757d;
        }
    </style>
</head>

<body>

    <!-- FLASH MESSAGES (top) -->
    <div class="container position-fixed top-0 start-50 translate-middle-x mt-3" style="z-index: 2000;">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, msg in messages %}
        <div class="alert alert-{{ category if category else 'info' }} alert-dismissible fade show" role="alert">
            {{ msg }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}
    </div>

    <!-- HERO SECTION -->
    <section id="hero" class="hero">
        <div class="hero-card shadow-sm">
            <div class="d-flex align-items-center justify-content-between mb-3">
                <div>
                    <h1 class="display-6 mb-1">Heart Disease Detector</h1>
                    <p class="mb-0 text-muted">Quick screening tool — enter basic info and get a risk estimate.</p>
                </div>
                <div>
                    <a class="btn btn-outline-primary btn-lg scroll-btn" id="go-to-form" href="#form-section">Check My
                        Risk</a>
                </div>
            </div>

            <hr>

            <!-- Prediction area (shows when server provides variables) -->
            <div id="prediction-area" class="text-center py-4">
                {% if prediction is defined and probability is defined %}
                {% set prob_percent = (probability * 100) | round(1) %}
                {% if prediction == 1 %}
                <h2 class="text-danger mb-2">Risk Detected</h2>
                <p class="lead mb-1">Estimated probability of risk: <strong>{{ prob_percent }}%</strong></p>
                <p class="mb-2">Threshold used: <strong>{{ (threshold * 100) | round(0) }}%</strong></p>
                <div class="mb-3">
                    <span class="badge bg-danger">High caution — consult a clinician</span>
                </div>
                {% else %}
                <h2 class="text-success mb-2">Low Risk</h2>
                <p class="lead mb-1">Estimated probability of risk: <strong>{{ prob_percent }}%</strong></p>
                <p class="mb-2">Threshold used: <strong>{{ (threshold * 100) | round(0) }}%</strong></p>
                <div class="mb-3">
                    <span class="badge bg-success">Low risk — discuss with clinician as needed</span>
                </div>
                {% endif %}
                <small class="text-muted">This prediction is algorithmic — see disclaimer below.</small>
                {% else %}
                <h2 class="mb-2">Safe. Fast. Simple.</h2>
                <p class="lead mb-0">Enter health details to estimate risk of heart disease — this is an automated
                    screening tool.</p>
                {% endif %}
            </div>

            <!-- Option: quick stats / tips -->
            <div class="row gx-2 mt-3">
                <div class="col-md-4">
                    <div class="p-2 border rounded text-center">
                        <strong>Quick tip</strong>
                        <div class="text-muted small">Regular exercise and a healthy diet reduce risk.</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="p-2 border rounded text-center">
                        <strong>What we use</strong>
                        <div class="text-muted small">Age, BP, cholesterol, lifestyle and lab markers.</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="p-2 border rounded text-center">
                        <strong>Note</strong>
                        <div class="text-muted small">Model tuned for screening — not a diagnosis.</div>
                    </div>
                </div>
            </div>

            <div class="text-center mt-4">
                <a class="btn btn-primary btn-lg scroll-btn" href="#form-section">Enter Data</a>
            </div>
        </div>
    </section>

    <!-- FORM SECTION -->
    <section id="form-section" class="py-5">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-10">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h3 class="card-title mb-3">Enter patient details</h3>
                            <form method="post" action="{{ url_for('predict') }}">
                                <!-- CSRF token if you use Flask-WTF -->
                                {% if csrf_token %}
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                {% endif %}

                                <div class="row g-3">
                                    <!-- Numeric group left -->
                                    <div class="col-md-6">
                                        <label class="form-label">Age</label>
                                        <input name="Age" type="number" min="0" max="120" step="1" class="form-control"
                                            placeholder="e.g., 41" value="{{ form_data.get('Age','') if form_data else '' }}"
                                            required>
                                    </div>

                                    <div class="col-md-6">
                                        <label class="form-label">Gender</label>
                                        <select name="Gender" class="form-select" required>
                                            <option value="">Choose...</option>
                                            <option value="Male" {% if form_data and form_data.get('Gender')=='Male' %}selected{% endif %}>Male</option>
                                            <option value="Female" {% if form_data and form_data.get('Gender')=='Female' %}selected{% endif %}>Female</option>
                                            <option value="Other" {% if form_data and form_data.get('Gender')=='Other' %}selected{% endif %}>Other</option>
                                        </select>
                                    </div>

                                    <div class="col-md-6">
                                        <label class="form-label">Blood Pressure (systolic)</label>
                                        <input name="Blood Pressure" type="number" min="50" max="250" step="1"
                                            class="form-control" placeholder="e.g., 118"
                                            value="{{ form_data.get('Blood Pressure','') if form_data else '' }}">
                                        <div class="field-help">Systolic mmHg (if unknown leave blank)</div>
                                    </div>

                                    <div class="col-md-6">
                                        <label class="form-label">Cholesterol Level (Total mg/dL)</label>
                                        <input name="Cholesterol Level" type="number" min="50" max="500" step="1"
                                            class="form-control" placeholder="e.g., 200"
                                            value="{{ form_data.get('Cholesterol Level','') if form_data else '' }}">
                                    </div>

                                    <div class="col-md-4">
                                        <label class="form-label">Exercise Habits</label>
                                        <select name="Exercise Habits" class="form-select">
                                            <option value="">Unknown</option>
                                            <option value="High" {% if form_data and form_data.get('Exercise Habits')=='High' %}selected{% endif %}>High</option>
                                            <option value="Medium" {% if form_data and form_data.get('Exercise Habits')=='Medium' %}selected{% endif %}>Medium</option>
                                            <option value="Low" {% if form_data and form_data.get('Exercise Habits')=='Low' %}selected{% endif %}>Low</option>
                                        </select>
                                    </div>

                                    <div class="col-md-4">
                                        <label class="form-label">Smoking</label>
                                        <select name="Smoking" class="form-select">
                                            <option value="">Unknown</option>
                                            <option value="Yes" {% if form_data and form_data.get('Smoking')=='Yes' %}selected{% endif %}>Yes</option>
                                            <option value="No" {% if form_data and form_data.get('Smoking')=='No' %}selected{% endif %}>No</option>
                                        </select>
                                    </div>

                                    <div class="col-md-4">
                                        <label class="form-label">Family Heart Disease</label>
                                        <select name="Family Heart Disease" class="form-select">
                                            <option value="">Unknown</option>
                                            <option value="Yes" {% if form_data and form_data.get('Family Heart Disease')=='Yes' %}selected{% endif %}>Yes</option>
                                            <option value="No" {% if form_data and form_data.get('Family Heart Disease')=='No' %}selected{% endif %}>No</option>
                                        </select>
                                    </div>

                                    <div class="col-md-4">
                                        <label class="form-label">Diabetes</label>
                                        <select name="Diabetes" class="form-select">
                                            <option value="">Unknown</option>
                                            <option value="Yes" {% if form_data and form_data.get('Diabetes')=='Yes' %}selected{% endif %}>Yes</option>
                                            <option value="No" {% if form_data and form_data.get('Diabetes')=='No' %}selected{% endif %}>No</option>
                                        </select>
                                    </div>

                                    <div class="col-md-4">
                                        <label class="form-label">BMI</label>
                                        <input name="BMI" type="number" min="10" max="60" step="0.1"
                                            class="form-control" placeholder="e.g., 24.5"
                                            value="{{ form_data.get('BMI','') if form_data else '' }}">
                                    </div>

                                    <div class="col-md-4">
                                        <label class="form-label">High Blood Pressure</label>
                                        <select name="High Blood Pressure" class="form-select">
                                            <option value="">Unknown</option>
                                            <option value="Yes" {% if form_data and form_data.get('High Blood Pressure')=='Yes' %}selected{% endif %}>Yes</option>
                                            <option value="No" {% if form_data and form_data.get('High Blood Pressure')=='No' %}selected{% endif %}>No</option>
                                        </select>
                                    </div>

                                    <div class="col-md-4">
                                        <label class="form-label">High LDL Cholesterol</label>
                                        <select name="High LDL Cholesterol" class="form-select">
                                            <option value="">Unknown</option>
                                            <option value="Yes" {% if form_data and form_data.get('High LDL Cholesterol')=='Yes' %}selected{% endif %}>Yes</option>
                                            <option value="No" {% if form_data and form_data.get('High LDL Cholesterol')=='No' %}selected{% endif %}>No</option>
                                        </select>
                                    </div>

                                    <div class="col-md-4">
                                        <label class="form-label">Alcohol Consumption</label>
                                        <select name="Alcohol Consumption" class="form-select">
                                            <option value="">Unknown</option>
                                            <option value="High" {% if form_data and form_data.get('Alcohol Consumption')=='High' %}selected{% endif %}>High</option>
                                            <option value="Medium" {% if form_data and form_data.get('Alcohol Consumption')=='Medium' %}selected{% endif %}>Medium</option>
                                            <option value="Low" {% if form_data and form_data.get('Alcohol Consumption')=='Low' %}selected{% endif %}>Low</option>
                                        </select>
                                    </div>

                                    <div class="col-md-4">
                                        <label class="form-label">Stress Level</label>
                                        <select name="Stress Level" class="form-select">
                                            <option value="">Unknown</option>
                                            <option value="High" {% if form_data and form_data.get('Stress Level')=='High' %}selected{% endif %}>High</option>
                                            <option value="Medium" {% if form_data and form_data.get('Stress Level')=='Medium' %}selected{% endif %}>Medium</option>
                                            <option value="Low" {% if form_data and form_data.get('Stress Level')=='Low' %}selected{% endif %}>Low</option>
                                        </select>
                                    </div>

                                    <div class="col-md-4">
                                        <label class="form-label">Sleep Hours</label>
                                        <input name="Sleep Hours" type="number" min="0" max="24" step="0.1"
                                            class="form-control" placeholder="e.g., 7.5"
                                            value="{{ form_data.get('Sleep Hours','') if form_data else '' }}">
                                    </div>

                                    <div class="col-md-4">
                                        <label class="form-label">Sugar Consumption</label>
                                        <select name="Sugar Consumption" class="form-select">
                                            <option value="">Unknown</option>
                                            <option value="High" {% if form_data and form_data.get('Sugar Consumption')=='High' %}selected{% endif %}>High</option>
                                            <option value="Medium" {% if form_data and form_data.get('Sugar Consumption')=='Medium' %}selected{% endif %}>Medium</option>
                                            <option value="Low" {% if form_data and form_data.get('Sugar Consumption')=='Low' %}selected{% endif %}>Low</option>
                                        </select>
                                    </div>

                                    <div class="col-md-4">
                                        <label class="form-label">Triglyceride Level (mg/dL)</label>
                                        <input name="Triglyceride Level" type="number" min="10" max="1000" step="0.1"
                                            class="form-control"
                                            value="{{ form_data.get('Triglyceride Level','') if form_data else '' }}">
                                    </div>

                                    <div class="col-md-4">
                                        <label class="form-label">Fasting Blood Sugar (mg/dL)</label>
                                        <input name="Fasting Blood Sugar" type="number" min="40" max="400" step="0.1"
                                            class="form-control"
                                            value="{{ form_data.get('Fasting Blood Sugar','') if form_data else '' }}">
                                    </div>

                                    <div class="col-md-4">
                                        <label class="form-label">CRP Level (mg/L)</label>
                                        <input name="CRP Level" type="number" min="0" max="100" step="0.01"
                                            class="form-control"
                                            value="{{ form_data.get('CRP Level','') if form_data else '' }}">
                                    </div>

                                    <div class="col-md-4">
                                        <label class="form-label">Homocysteine Level (µmol/L)</label>
                                        <input name="Homocysteine Level" type="number" min="0" max="100" step="0.1"
                                            class="form-control"
                                            value="{{ form_data.get('Homocysteine Level','') if form_data else '' }}">
                                    </div>

                                    <div class="col-12 text-end mt-3">
                                        <button type="submit" class="btn btn-primary btn-lg">Calculate Risk & Scroll
                                            Up</button>
                                    </div>
                                </div>
                            </form>

                            <div class="mt-3 text-muted small">
                                Tip: You don't need to fill every field. Missing values will be handled by the model's
                                imputer.
                            </div>
                        </div>
                    </div>

                    <!-- small disclaimer / info -->
                    <div class="mt-3 small text-muted">
                        <strong>Note:</strong> This tool is for screening only. It provides probabilistic estimates and
                        is not a medical diagnosis. Always consult a qualified healthcare professional for medical
                        advice.
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="small-disclaimer mt-5">
        <div class="container text-center">
            <p class="mb-1">Model disclaimer: This prediction model is intended as a screening aid. It was trained on
                historical data and may not generalize to all populations. Do not use it as a substitute for
                professional medical advice.</p>
            <p class="mb-0 text-muted">© {{ current_year() }} Heart Disease Detector</p>
        </div>
    </footer>

    <!-- Bootstrap JS (Popper + Bootstrap) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Smooth scroll when clicking CTA - already handled by anchor with CSS smooth behavior but add fallback
        document.querySelectorAll('.scroll-btn').forEach(btn => {
            btn.addEventListener('click', function (e) {
                // if href target present, let browser handle, otherwise prevent default
                const href = btn.getAttribute('href') || btn.dataset.target;
                if (href && href.startsWith('#')) {
                    e.preventDefault();
                    const el = document.querySelector(href);
                    if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });

        // After a POST that returned prediction, scroll to hero so user sees result
        {% if prediction is defined and probability is defined %}
        setTimeout(() => {
            const hero = document.getElementById('hero');
            if (hero) hero.scrollIntoView({ behavior: 'smooth' });
        }, 300);
        {% endif %}
    </script>
</body>

</html>
